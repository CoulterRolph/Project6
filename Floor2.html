<!DOCTYPE html>
<!--[if lt IE 9]>
	<script src=http://html5shiv.googlecode.com/svn/trunk/html5.js></script>
<![endif] -->
<html>
<link rel="icon" href="Photos/Logo.png" type="image/png">

<head>
	<title> Project VI - Index </title>
	<meta name="description" content="This is the home page of our project" />
	<meta name="robots" content="noindex nofollow" />
	<meta http-equiv="author" content="Coulter, David, Stuart" />
	<meta http-equiv="pargma" content="no-cache" />
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-
		QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link href="css/Sidebar.css" type="text/css" rel="stylesheet" />
	<link href="css/Topbar.css" type="text/css" rel="stylesheet" />
	<link href="css/Button.css" type="text/css" rel="stylesheet" />
</head>

<body>
	<script>
		fetch('php/GUIAuthentication.php')
			.then(r => r.json())
			.then(data => {
				if (!data.authenticated) {
					window.location.href = 'login.html?error=auth';
				}
			});
	</script>
	<div id="page" class="container-fluid">
		<div class="row min-vh-100">
			<div class="col-md-3 col-lg-2" id="sidebar">
				<script src="js/sidebar.js"></script>
			</div>

			<section class="col-md-9 col-lg-10 px-md-4 py-4">

				<nav class="mb-4 border-bottom pb-2">
					<ul class="nav">
						<li class="nav-item"><a class="nav-link topbar" href="Inside.html">Inside</a></li>
						<li class="nav-item"><a class="nav-link topbar" href="Floor1.html">Floor 1</a></li>
						<li class="nav-item"><a class="nav-link topbar topbarcurrent" href="Floor2.html">Floor 2</a></li>
						<li class="nav-item"><a class="nav-link topbar" href="Floor3.html">Floor 3</a></li>
						<li class="nav-item"><a class="nav-link topbar" href="diagnostics.html">Diagnostics</a></li>
					</ul>
				</nav>

				<header class="mb-5 row">
					<div class="col-xs-12 text-center">
						<h1>Current Floor: <span class="badge bg-secondary" id="current-floor">2</span></h1>
					</div>
				</header>

				<article class="mb-5 row">
					<div class="col-12 d-flex justify-content-center">
						<div class="p-5 border border-4 rounded-4 shadow bg-light">
							<div class="mb-2 text-center">
								<button id="floor2Up-btn" onclick="sendElevatorRequest(2, 2)"
									class="btn btn-outline-primary big-btn">↑</button>
							</div>
							<div class="mb-2 text-center">
								<button id="floor2Down-btn" onclick="sendElevatorRequest(2, 1)"
									class="btn btn-outline-primary big-btn">↓</button>
							</div>

						</div>
					</div>
				</article>

				<section class="row justify-content-center">
					<div class="col-5 me-5">
						<h2>Elevator Status:</h2>
					</div>
					<div class="col-5">
						<h2>Elevator Messages:</h2>
					</div>
				</section>
				<section class="row justify-content-center">
					<div class="col-5 border shadow bg-light p-3 me-5">
						<h4 id="elevator-status"> - ESE, it's in the game.</h4>
					</div>
					<div class="col-5 border shadow bg-light p-3">
						<h4 id="elevator-message"> - Working hard or hardly working?</h4>
					</div>
				</section>
		</div>
	</div>

	<script>
		function sendElevatorRequest(nodeID, floorRequest) {
			fetch('php/elevatorReq.php', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded'
				},
				body: 'nodeID=' + encodeURIComponent(nodeID) +
					'&floorRequest=' + encodeURIComponent(floorRequest)
			})
				.then(response => response.text())
				.then(data => {
					alert(data); // Or display this elsewhere on the page
				})
				.catch(error => {
					alert("Request failed: " + error);
				});
		}
	</script>

	<script>
		function pollOutsideStatus() {
			fetch('php/floor2States.php')
				.then(r => r.json())
				.then(data => {
					// Update current floor
					const currentFloor = document.getElementById('current-floor');
					if (currentFloor && data.currentFloor !== undefined) {
						currentFloor.textContent = data.currentFloor;
					}

					// Update status text
					const status = document.getElementById('elevator-status');
					if (status && data.status !== undefined) {
						status.textContent = data.status;
					}

					// Update message text
					const message = document.getElementById('elevator-message');
					if (message && data.messages !== undefined) {
						message.textContent = data.messages;
					}

					const floor2Upbtn = document.getElementById('floor2Up-btn');
					const floor2Downbtn = document.getElementById('floor2Down-btn');
					if (floor2Upbtn && floor2Downbtn && data.floorRequest !== undefined) {
						if (parseInt(data.floorRequest, 10) === 1) {
							floor2Downbtn.classList.remove('btn-outline-primary');
							floor2Downbtn.classList.add('btn-primary');
							floor2Upbtn.classList.remove('btn-primary');
							floor2Upbtn.classList.add('btn-outline-primary');
						} else if (parseInt(data.floorRequest, 10) === 2) {
							floor2Upbtn.classList.remove('btn-outline-primary');
							floor2Upbtn.classList.add('btn-primary');
							floor2Downbtn.classList.remove('btn-primary');
							floor2Downbtn.classList.add('btn-outline-primary');
						} else {
							floor2Upbtn.classList.remove('btn-primary');
							floor2Upbtn.classList.add('btn-outline-primary');
							floor2Downbtn.classList.remove('btn-primary');
							floor2Downbtn.classList.add('btn-outline-primary');
						}
					}

				})
				.catch(err => console.error('Outside elevator poll error:', err));
		}

		pollOutsideStatus();                  // Run immediately
		setInterval(pollOutsideStatus, 3000); // Then every 3 s
	</script>

	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-
		YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>

</html>