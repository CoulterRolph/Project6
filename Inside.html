<!DOCTYPE html>
<!--[if lt IE 9]>
	<script src=http://html5shiv.googlecode.com/svn/trunk/html5.js></script>
<![endif] -->
<html>
<link rel="icon" href="Photos/Logo.png" type="image/png">

<head>
	<title> Project VI - Index </title>
	<meta name="description" content="This is the home page of our project" />
	<meta name="robots" content="noindex nofollow" />
	<meta http-equiv="author" content="Coulter, David, Stuart" />
	<meta http-equiv="pargma" content="no-cache" />
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-
		QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link href="css/Sidebar.css" type="text/css" rel="stylesheet" />
	<link href="css/Topbar.css" type="text/css" rel="stylesheet" />
	<link href="css/Button.css" type="text/css" rel="stylesheet" />
</head>

<body>
	<script>
		fetch('php/GUIAuthentication.php')
			.then(r => r.json())
			.then(data => {
				if (!data.authenticated) {
					window.location.href = 'login.html?error=auth';
				}
			});
	</script>
	<div id="page" class="container-fluid">
		<div class="row min-vh-100">
			<div class="col-md-3 col-lg-2" id="sidebar">
				<script src="js/sidebar.js"></script>
			</div>

			<section class="col-md-9 col-lg-10 px-md-4 py-4">

				<nav class="mb-4 border-bottom pb-2">
					<ul class="nav">
						<li class="nav-item"><a class="nav-link topbar topbarcurrent" href="Inside.html">Inside</a></li>
						<li class="nav-item"><a class="nav-link topbar" href="Floor1.html">Floor 1</a></li>
						<li class="nav-item"><a class="nav-link topbar" href="Floor2.html">Floor 2</a></li>
						<li class="nav-item"><a class="nav-link topbar" href="Floor3.html">Floor 3</a></li>
					</ul>
				</nav>

				<header class="mb-5 row">
					<div class="col-xs-12 text-center">
						<h1>Current Floor: <span class="badge bg-secondary" id="current-floor">2</span></h1>
					</div>
				</header>

				<article class="mb-5 row justify-content-center g-4">
					<div class="col-md-4 d-flex justify-content-end">
						<div class="p-5 border border-4 rounded-4 shadow bg-light h-100 d-flex flex-column justify-content-center"
							style="width:346px;">
							<div class="mb-2 text-center">
								<button id="floor3-btn" onclick="requestFloor(3)"
									class="btn btn-outline-primary med-btn">3</button>
							</div>
							<div class="mb-2 text-center">
								<button id="floor2-btn" onclick="requestFloor(2)"
									class="btn btn-outline-primary med-btn">2</button>
							</div>
							<div class="text-center">
								<button id="floor1-btn" onclick="requestFloor(1)"
									class="btn btn-outline-primary med-btn">1</button>
							</div>
						</div>
					</div>

					<div class="col-md-4 d-flex justify-content-center">
						<div class="p-5 border border-4 rounded-4 shadow bg-light h-100 d-flex flex-column justify-content-center"
							style="width:346px;">
							<div class="mb-5 text-center">
								<button class="btn btn-outline-primary med-btn">
									&lt;|&gt;
								</button>
							</div>
							<div class="text-center">
								<button class="btn btn-outline-primary med-btn">
									&gt;|&lt;
								</button>
							</div>
						</div>
					</div>

					<div class="col-4 d-flex justify-content-start">
						<div class="p-5 border border-4 rounded-4 shadow bg-light h-100 d-flex flex-column justify-content-center"
							style="width:346px;">
							<div class="mb-5 text-center">
								<button id="alarm-btn" class="btn btn-outline-primary med-btn" onclick="triggerAlarm()">
									&#128276;
								</button>

							</div>
							<div class="text-center">
								<button class="btn btn-outline-primary med-btn">
									&#128222;
								</button>
							</div>
						</div>
					</div>
				</article>

				<section class="row justify-content-center">
					<div class="col-5 me-5">
						<h2>Elevator Status:</h2>
					</div>
					<div class="col-5">
						<h2>Elevator Messages:</h2>
					</div>
				</section>
				<section class="row justify-content-center">
					<div class="col-5 border shadow bg-light p-3 me-5">
						<h4 id="elevator-status"> - ESE, it's in the game.</h4>
					</div>
					<div class="col-5 border shadow bg-light p-3">
						<h4 id="elevator-message"> - Working hard or hardly working?</h4>
					</div>
				</section>
		</div>
	</div>

	<script>
		function requestFloor(floor) {
			fetch('php/floorReq.php', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded'
				},
				body: 'floorRequest=' + encodeURIComponent(floor)
			})
				.then(response => response.text())
				.then(data => {
					// Show the result in an alert or on the page
					alert(data); // Replace with UI update if needed
				})
				.catch(error => {
					alert("Error: " + error);
				});
		}
	</script>

	<script>
		function pollLEDStatus() {
			fetch('php/floorLEDStates.php')
				.then(r => r.json())
				.then(data => {
					// Floor buttons
					const btn1 = document.getElementById('floor1-btn');
					if (btn1) {
						if (parseInt(data.requestedFloor1, 10) === 2) {
							btn1.classList.remove('btn-outline-primary');
							btn1.classList.add('btn-primary');
						} else {
							btn1.classList.remove('btn-primary');
							btn1.classList.add('btn-outline-primary');
						}
					}

					const btn2 = document.getElementById('floor2-btn');
					if (btn2) {
						if (parseInt(data.requestedFloor2, 10) === 2) {
							btn2.classList.remove('btn-outline-primary');
							btn2.classList.add('btn-primary');
						} else {
							btn2.classList.remove('btn-primary');
							btn2.classList.add('btn-outline-primary');
						}
					}

					const btn3 = document.getElementById('floor3-btn');
					if (btn3) {
						if (parseInt(data.requestedFloor3, 10) === 2) {
							btn3.classList.remove('btn-outline-primary');
							btn3.classList.add('btn-primary');
						} else {
							btn3.classList.remove('btn-primary');
							btn3.classList.add('btn-outline-primary');
						}
					}

					// Update current floor
					const currentFloor = document.getElementById('current-floor');
					if (currentFloor && data.currentFloor !== undefined) {
						currentFloor.textContent = data.currentFloor;
					}

					// Update status
					const status = document.getElementById('elevator-status');
					if (status && data.status !== undefined) {
						status.textContent = data.status;
					}

					// Update message
					const message = document.getElementById('elevator-message');
					if (message && data.messages !== undefined) {
						message.textContent = data.messages;
					}
				})
				.catch(err => console.error('LED poll error:', err));
		}

		pollLEDStatus();
		setInterval(pollLEDStatus, 3000);
	</script>


	<script>
		let alarmTriggered = false;

		function triggerAlarm() {
			alarmTriggered = true;
			alert("ðŸš¨ Alarm triggered! All buttons are now disabled.");
			disableAllButtons();
		}

		function disableAllButtons() {
			const allButtons = document.querySelectorAll('button');
			allButtons.forEach(btn => {
				// Disable all buttons visually and functionally
				btn.disabled = true;
				btn.classList.add('disabled');
			});
		}

		// Modify requestFloor to respect alarm
		function requestFloor(floor) {
			if (alarmTriggered) return;

			fetch('php/floorReq.php', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/x-www-form-urlencoded'
				},
				body: 'floorRequest=' + encodeURIComponent(floor)
			})
				.then(response => response.text())
				.then(data => {
					alert(data);
				})
				.catch(error => {
					alert("Error: " + error);
				});
		}
	</script>




	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-
		YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>

</html>